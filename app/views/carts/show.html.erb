<div class="container" style="margin-top: 100px;">
  <div class="cart-container bg-white shadow rounded p-4">
    <h2 class="mb-4">🛒 カートの中身</h2>

    <% if @cart_items.empty? %>
      <p>カートには商品が入っていません。</p>
      <%= link_to "商品を見に行く", root_path, class: "btn btn-primary" %>
    <% else %>
      <table class="table table-hover">
        <thead class="thead-light">
          <tr>
            <th>商品名</th>
            <th>価格</th>
            <th>数量</th>
            <th>小計</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% total = 0 %>
          <% @cart_items.each do |item| %>
            <% product = item.product %>
            <% subtotal = product.price * item.quantity %>
            <% total += subtotal %>

            <tr>
              <td><strong><%= product.name %></strong></td>
              <td>¥<%= product.price %></td>
              <td style="width: 120px;">
                <%= form_with model: item, url: cart_item_path(item), local: true, method: :patch do |f| %>
                  <%= f.number_field :quantity, value: item.quantity, min: 1,
                      class: "form-control form-control-sm d-inline-block",
                      style: "width: 70px;" %>
                  <%= f.submit "更新", class: "btn btn-sm btn-outline-secondary mt-1" %>
                <% end %>
              </td>
              <td><strong>¥<%= subtotal %></strong></td>
              <td>
                <%= button_to "削除", cart_item_path(item),
                              method: :delete,
                              data: { confirm: "本当に削除しますか？" },
                              class: "btn btn-sm btn-danger" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <div class="text-right mt-4">
        <h4><strong>合計金額: ¥<%= total %></strong></h4>
      </div>
    <% end %>
  </div>
</div>